package com.mms;

import java.awt.Color;
import java.awt.Component;
import java.awt.event.KeyEvent;
import java.io.File;
import java.net.URISyntaxException;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.prefs.Preferences;
import javax.swing.ImageIcon;
import javax.swing.JFileChooser;
import javax.swing.JPanel;

public class Setup extends javax.swing.JDialog {

    private boolean complete = false;
    private final Preferences p = MMS.getPrefs();
    
    /**
     * Creates new form Setup
     * @param parent
     * @param modal
     */
    public Setup(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        setTitle(MMS.NAME+" - Database Setup");
        setIconImage(MMS.systemIcon);
        setLocationRelativeTo(parent);
        try {
            derbyDirField.setText(new File(MMS.class.getProtectionDomain().getCodeSource().getLocation().toURI()).getParentFile().getPath());
        } catch (URISyntaxException ex) {
            Logger.getLogger(Setup.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        typeRadioGroup = new javax.swing.ButtonGroup();
        derbyRadioGroup = new javax.swing.ButtonGroup();
        dbSelector = new javax.swing.JFileChooser();
        backPanel = new javax.swing.JPanel();
        derbyRadio = new javax.swing.JRadioButton();
        microsoftRadio = new javax.swing.JRadioButton();
        microsoftPanel = new javax.swing.JPanel();
        srvrField = new javax.swing.JTextField();
        srvrLabel = new javax.swing.JLabel();
        dbField = new javax.swing.JTextField();
        dbLabel = new javax.swing.JLabel();
        usrLabel = new javax.swing.JLabel();
        usrField = new javax.swing.JTextField();
        passField = new javax.swing.JPasswordField();
        passLabel = new javax.swing.JLabel();
        derbyPanel = new javax.swing.JPanel();
        derbyNewRadio = new javax.swing.JRadioButton();
        derbyNameField = new javax.swing.JTextField();
        derbyNameLabel = new javax.swing.JLabel();
        derbyExistingRadio = new javax.swing.JRadioButton();
        derbyDirLabel = new javax.swing.JLabel();
        derbyDirField = new javax.swing.JTextField();
        derbyDirButton = new javax.swing.JButton();
        continueButton = new javax.swing.JButton();
        statusLabel = new javax.swing.JLabel();

        dbSelector.setDialogTitle("Select Database Location");
        dbSelector.setFileSelectionMode(javax.swing.JFileChooser.DIRECTORIES_ONLY);

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });

        typeRadioGroup.add(derbyRadio);
        derbyRadio.setSelected(true);
        derbyRadio.setText("Standalone (Derby)");
        derbyRadio.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                derbyRadioStateChanged(evt);
            }
        });
        derbyRadio.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        typeRadioGroup.add(microsoftRadio);
        microsoftRadio.setText("Microsoft SQL Server");
        microsoftRadio.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                microsoftRadioStateChanged(evt);
            }
        });
        microsoftRadio.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        srvrField.setEnabled(false);
        srvrField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        srvrLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        srvrLabel.setText("Address:");
        srvrLabel.setEnabled(false);

        dbField.setEnabled(false);
        dbField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        dbLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        dbLabel.setText("Database:");
        dbLabel.setEnabled(false);

        usrLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        usrLabel.setText("Username:");
        usrLabel.setEnabled(false);

        usrField.setEnabled(false);
        usrField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        passField.setEnabled(false);
        passField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        passLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        passLabel.setText("Password:");
        passLabel.setEnabled(false);

        javax.swing.GroupLayout microsoftPanelLayout = new javax.swing.GroupLayout(microsoftPanel);
        microsoftPanel.setLayout(microsoftPanelLayout);
        microsoftPanelLayout.setHorizontalGroup(
            microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(microsoftPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(dbLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 53, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(srvrLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 53, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(usrLabel)
                    .addComponent(passLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 53, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(srvrField, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(dbField)
                    .addComponent(usrField, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(passField))
                .addContainerGap())
        );
        microsoftPanelLayout.setVerticalGroup(
            microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(microsoftPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(srvrLabel)
                    .addComponent(srvrField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(dbLabel)
                    .addComponent(dbField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(usrLabel)
                    .addComponent(usrField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(microsoftPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(passLabel)
                    .addComponent(passField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        derbyRadioGroup.add(derbyNewRadio);
        derbyNewRadio.setSelected(true);
        derbyNewRadio.setText("Create new database");
        derbyNewRadio.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                derbyNewRadioStateChanged(evt);
            }
        });
        derbyNewRadio.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        derbyNameField.setText(MMS.NAME+"_DB");
        derbyNameField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        derbyNameLabel.setText("Name:");

        derbyRadioGroup.add(derbyExistingRadio);
        derbyExistingRadio.setText("Use existing database");
        derbyExistingRadio.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                srvrFieldKeyPressed(evt);
            }
        });

        derbyDirLabel.setText("Location:");

        derbyDirField.setEditable(false);
        derbyDirField.setText("Default");

        derbyDirButton.setText("...");
        derbyDirButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                derbyDirButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout derbyPanelLayout = new javax.swing.GroupLayout(derbyPanel);
        derbyPanel.setLayout(derbyPanelLayout);
        derbyPanelLayout.setHorizontalGroup(
            derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(derbyPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(derbyPanelLayout.createSequentialGroup()
                        .addGroup(derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(derbyPanelLayout.createSequentialGroup()
                                .addComponent(derbyExistingRadio)
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addComponent(derbyDirField))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(derbyDirButton))
                    .addComponent(derbyNewRadio)
                    .addComponent(derbyDirLabel)
                    .addGroup(derbyPanelLayout.createSequentialGroup()
                        .addGap(21, 21, 21)
                        .addComponent(derbyNameLabel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(derbyNameField, javax.swing.GroupLayout.PREFERRED_SIZE, 169, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        derbyPanelLayout.setVerticalGroup(
            derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(derbyPanelLayout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addComponent(derbyNewRadio)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(derbyNameLabel)
                    .addComponent(derbyNameField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(derbyExistingRadio, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(derbyDirLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(derbyPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(derbyDirField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(derbyDirButton))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        continueButton.setText("Continue");
        continueButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                continueButtonActionPerformed(evt);
            }
        });

        statusLabel.setText("   ");

        javax.swing.GroupLayout backPanelLayout = new javax.swing.GroupLayout(backPanel);
        backPanel.setLayout(backPanelLayout);
        backPanelLayout.setHorizontalGroup(
            backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(backPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(microsoftPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(derbyPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(backPanelLayout.createSequentialGroup()
                        .addGroup(backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(backPanelLayout.createSequentialGroup()
                                .addGroup(backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(microsoftRadio)
                                    .addComponent(derbyRadio))
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, backPanelLayout.createSequentialGroup()
                                .addGap(7, 7, 7)
                                .addComponent(statusLabel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(continueButton)))
                        .addContainerGap())))
        );
        backPanelLayout.setVerticalGroup(
            backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(backPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(derbyRadio)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(derbyPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(microsoftRadio)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(microsoftPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(backPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(continueButton)
                    .addComponent(statusLabel))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(backPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(backPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void continueButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_continueButtonActionPerformed
        if(derbyRadio.isSelected()){ //DERBY
            setPanelEnabled(backPanel, false);
            statusLabel.setIcon(new ImageIcon(MMS.ajaxIcon));
            statusLabel.setForeground(Color.black);
            statusLabel.setText("Connecting...");
            new Thread(){
                @Override
                public void run(){
                    try {
                        //Register driver
                        DriverManager.registerDriver(new org.apache.derby.jdbc.EmbeddedDriver());
                        //Set name & directory
                        String dbName, dbDir;
                        if(derbyNewRadio.isSelected()){
                            dbName = derbyNameField.getText();
                            dbDir = derbyDirField.getText()+"\\";
                        }
                        else{
                            dbName = derbyDirField.getText().substring(derbyDirField.getText().lastIndexOf("\\")+1, derbyDirField.getText().length());
                            dbDir = derbyDirField.getText().substring(0, derbyDirField.getText().lastIndexOf("\\"));
                        }         
                        System.setProperty("user.dir", dbDir);
                        System.setProperty("derby.system.home", dbDir);
                        //Try connect
                        if(derbyNewRadio.isSelected()){
                            MMS.setConnection(DriverManager.getConnection("jdbc:derby:"+dbName+";create=true"));
                            System.out.println("[DATABASE] Connected to Derby: "+dbName);
                            //Create database
                            statusLabel.setText("Creating DB...");
                            createDerby();
                        }
                        else{
                            MMS.setConnection(DriverManager.getConnection("jdbc:derby:"+dbName));
                            System.out.println("[DATABASE] Connected to Derby: "+dbName);
                        }

                        //Put preferences
                        p.put("dbType", "derby");
                        p.put("derbyHome", dbDir);
                        p.put("derbyName", dbName);
                        p.putBoolean("firstRun", false);
                       

                        complete = true;
                        dispose();
                    } catch (SQLException ex) {
                        Logger.getLogger(MMS.class.getName()).log(Level.SEVERE, null, ex);
                        setPanelEnabled(backPanel, true);
                        statusLabel.setIcon(null);
                        statusLabel.setForeground(Color.red);
                        statusLabel.setText("Connection failed!");
                    }
                }
            }.start();
        }
        else{ //MSSQL
            String srvr = srvrField.getText(), 
               db = dbField.getText(),
               usr = usrField.getText(),
               pass = passField.getText();
            if(srvr.isEmpty()) srvrField.requestFocus();
            else if(db.isEmpty()) dbField.requestFocus();
            else if(usr.isEmpty()) usrField.requestFocus();
            else if(pass.isEmpty()) passField.requestFocus();
            else{
                setPanelEnabled(backPanel, false);
                statusLabel.setIcon(new ImageIcon(MMS.ajaxIcon));
                statusLabel.setForeground(Color.black);
                statusLabel.setText("Connecting...");
                new Thread(){
                    @Override
                    public void run(){
                        try {
                            //Register driver
                            DriverManager.registerDriver(new com.microsoft.sqlserver.jdbc.SQLServerDriver());
                            //Try connect
                            MMS.setConnection(DriverManager.getConnection("jdbc:sqlserver://"+srvr+";databaseName="+db+";user="+usr+";password="+pass+";loginTimeout=4"));
                            System.out.println("[DATABASE] Connected to MSSQL: "+db);
                            
                            //Put preferences
                            p.put("dbType", "mssql");
                            p.put("mssqlsrvr", srvr);
                            p.put("mssqldb", db);
                            p.put("mssqlusr", usr);
                            p.put("mssqlpass", pass);
                            p.putBoolean("firstRun", false);
                            
                            complete = true;
                            dispose();
                        } catch (SQLException ex) {
                            Logger.getLogger(MMS.class.getName()).log(Level.SEVERE, null, ex);
                            setPanelEnabled(backPanel, true);
                            statusLabel.setIcon(null);
                            statusLabel.setForeground(Color.red);
                            statusLabel.setText("Connection failed!");
                            srvrField.requestFocus();
                        }
                    }
                }.start();
            }
        }  
    }//GEN-LAST:event_continueButtonActionPerformed

    private void srvrFieldKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_srvrFieldKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER) {
            continueButtonActionPerformed(null);
        }
    }//GEN-LAST:event_srvrFieldKeyPressed

    private void microsoftRadioStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_microsoftRadioStateChanged
        if(backPanel.isEnabled()) setPanelEnabled(microsoftPanel, microsoftRadio.isSelected());
    }//GEN-LAST:event_microsoftRadioStateChanged

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        if(!complete) MMS.shutdown();
    }//GEN-LAST:event_formWindowClosed

    private void derbyDirButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_derbyDirButtonActionPerformed
        if(dbSelector.showDialog(this, "Select") == JFileChooser.APPROVE_OPTION){
            derbyDirField.setText(dbSelector.getSelectedFile()+"");
        }
    }//GEN-LAST:event_derbyDirButtonActionPerformed

    private void derbyNewRadioStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_derbyNewRadioStateChanged
        derbyNameField.setEnabled(derbyNewRadio.isSelected());
        derbyNameLabel.setEnabled(derbyNewRadio.isSelected());
    }//GEN-LAST:event_derbyNewRadioStateChanged

    private void derbyRadioStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_derbyRadioStateChanged
        if(backPanel.isEnabled()) setPanelEnabled(derbyPanel, derbyRadio.isSelected());
    }//GEN-LAST:event_derbyRadioStateChanged

    private void createDerby(){
        try {
            Statement st = MMS.getConnection().createStatement();
            st.executeUpdate("CREATE TABLE CARS(ID INT PRIMARY KEY,"
                    + "NAME VARCHAR(30), PRICE INT)");
            st.executeUpdate("INSERT INTO CARS VALUES(1, 'Audi', 52642)");
            
            System.out.println("[DATABASE] Derby database created.");
        } catch (SQLException ex) {
            Logger.getLogger(Setup.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    
    private void setPanelEnabled(JPanel panel, Boolean isEnabled) {
        panel.setEnabled(isEnabled);
        Component[] components = panel.getComponents();
        for (Component component : components) {
            if (component instanceof JPanel) {
                setPanelEnabled((JPanel)component, isEnabled);
            }
            else if((component.equals(derbyNameField) || component.equals(derbyNameLabel)) && backPanel.isEnabled()) component.setEnabled(derbyNewRadio.isSelected());
            else if(!component.equals(statusLabel)) component.setEnabled(isEnabled);
        }
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel backPanel;
    private javax.swing.JButton continueButton;
    private javax.swing.JTextField dbField;
    private javax.swing.JLabel dbLabel;
    private javax.swing.JFileChooser dbSelector;
    private javax.swing.JButton derbyDirButton;
    private javax.swing.JTextField derbyDirField;
    private javax.swing.JLabel derbyDirLabel;
    private javax.swing.JRadioButton derbyExistingRadio;
    private javax.swing.JTextField derbyNameField;
    private javax.swing.JLabel derbyNameLabel;
    private javax.swing.JRadioButton derbyNewRadio;
    private javax.swing.JPanel derbyPanel;
    private javax.swing.JRadioButton derbyRadio;
    private javax.swing.ButtonGroup derbyRadioGroup;
    private javax.swing.JPanel microsoftPanel;
    private javax.swing.JRadioButton microsoftRadio;
    private javax.swing.JPasswordField passField;
    private javax.swing.JLabel passLabel;
    private javax.swing.JTextField srvrField;
    private javax.swing.JLabel srvrLabel;
    private javax.swing.JLabel statusLabel;
    private javax.swing.ButtonGroup typeRadioGroup;
    private javax.swing.JTextField usrField;
    private javax.swing.JLabel usrLabel;
    // End of variables declaration//GEN-END:variables
}
